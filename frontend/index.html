<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>LurkForWork</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- You can add your styles and scripts here -->
    <!-- <link rel="stylesheet" type="text/css" media="screen" href="styles/provided.css" /> -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <link href="./styles/sign-in.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
    </style>
    
</head>
<body>
    <!-- This is an example app structure, you can modify this as much as you choose --> 
    <header>
    </header>


    <main role="main">
        <!-- This is page login -->
        <div class="page login">
            <div class="form-signin w-100 m-auto">
                <form>
                  <img class="logo" src="./assets/icon/logo_rick.webp" alt="" width="72" height="57">
                  <h1 class="h3 mb-3 fw-normal">Please sign in</h1>

                  <div class="form-floating">
                    <input type="email" class="form-control " id="loginEmail" placeholder="name@example.com">
                    <label for="floatingInput">Email address</label>
                  </div>
                  <div class="form-floating">
                    <input type="password" class="form-control" id="loginPassword" placeholder="Password">
                    <label for="floatingPassword">Password</label>
                  </div>
              
                  <div class="checkbox mb-3">
                  </div>
                  <button class="w-100 btn btn-lg btn-primary" id="submitSingin" type="submit">Sign in</button>
                  <a href="#register">No Account? Register Now!</a>
                </form>
            </div>
        </div>
        <!-- This is the page register -->
        <div class="page register" style="display: none;">
            <div class="form-signin w-100 m-auto">
                <form>
                  <img class="logo" src="./assets/icon/logo_rick.webp" alt="" width="72" height="57">
                  <h1 class="h3 mb-3 fw-normal">Be a new member Now!</h1>
                  <div class="form-floating">
                    <input type="name" class="form-control" id="inputName" placeholder="name">
                    <label for="floatingInput">Name</label>
                  </div>
                  <div class="form-floating">
                    <input type="email" class="form-control" id="input email" placeholder="name@example.com">
                    <label for="floatingInput">Email address</label>
                  </div>
                  <div class="form-floating">
                    <input style="margin-bottom: 0%;" type="password" class="form-control" id="inputPassword" placeholder="Password">
                    <label for="floatingPassword">Password</label>
                  </div>
                  <div class="form-floating">
                    <input type="Password" class="form-control" id="inputComfirmPassword" placeholder="Password">
                    <label for="floatingPassword">ConfirmPassword</label>
                  </div>
              
                  <div class="checkbox mb-3">
                  </div>
                  <button class="w-100 btn btn-lg btn-primary" type="submit">Register</button>
                  
                  <a href="#login">Already have Account? Sign in Now!</a>
                </form>
            </div>
        </div>
        <!-- This is page after login which is the job list -->
        <div class="page job-found" style="display: none;">
            THis is Job Found
        </div>
        <p class="mt-5 mb-3 text-muted">&copy; 2017â€“2022</p>
    </main>



    <!-- <footer>
        <p>&copy; lurkforwork.com 2022</p>
    </footer> -->
    <!-- <script type="module" src="src/main.js"></script> -->
</body>
    <script>
        //check if is already login 
        function getToken(){
            return localStorage.getItem('token'); 
        }
        const isLogin = !!getToken();

        // get the diffent pages elements
        const login = document.querySelector('.page.login');
        const register = document.querySelector('.page.register');
        const jobFound = document.querySelector('.page.job-found');

        // add event listener to the window
        function showLogin() {
            login.style.display = 'flex';
            register.style.display = 'none';
            jobFound.style.display = 'none';
        }

        function showRegister() {
            login.style.display = 'none';
            register.style.display = 'flex';
            jobFound.style.display = 'none';
        }

        function showJobFound() {
            login.style.display = 'none';
            register.style.display = 'none';
            jobFound.style.display = 'flex';
        }
    

        // show the page based on the hash value in the url
        
        function onHashChange() {
            const hash = window.location.hash;
            const curPage = hash.replace('#', '');
            switch(curPage) {
                case 'login':{
                    showLogin();
                    break;
                }
                case 'register':{
                    showRegister();
                    break;
                }
                case 'job-found':{
                    showJobFound();
                    break;       
                }     
                default:{
                    isLogin ? showJobFound() : showLogin();
                    break;
                }
            }
        }
        // load the page based on the hash value
        window.onhashchange = onHashChange;


        // add event to the Sign in button in login page
        const submitsignIn = document.querySelector('#submitSingin');
        submitsignIn.addEventListener('click', () => {
            const loginEmail = document.getElementById('loginEmail').value;
            const loginPassword = document.getElementById('loginPassword').value;
            const postMethod = {
                method: 'POST',
                headers: {
                    'Content-type': 'application/json'
                },
                body: JSON.stringify({
                    email: loginEmail,
                    password: loginPassword
                })
            }
    
            fetch('http://localhost:5005/auth/login', postMethod)
            .then((Response) => {
                Response.json()
                .then((data) => {
                    if (data.error){
                        alert(data.error)
                    }else{
                        console.log('Success! the data is ', data);
                        localStorage.setItem('token', data.token);
                    }
                })
            })
            Location.hash = '#job-found';
            console.log(isLogin);
            onHashChange();
            
        })
    </script>
</html>
